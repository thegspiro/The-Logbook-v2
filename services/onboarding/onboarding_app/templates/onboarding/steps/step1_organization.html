{% extends 'onboarding/steps/step_base.html' %}

{% block step_description %}
Let's start by setting up your organization's basic information and theme colors.
{% endblock %}

{% block step_content %}
<div class="space-y-6">
    <!-- Organization Name -->
    <div>
        <label for="organization_name" class="block text-sm font-semibold text-gray-700 mb-2">
            Fire Department Name <span class="text-red-500" aria-label="required">*</span>
        </label>
        <input type="text"
               id="organization_name"
               name="organization_name"
               value="{{ config.organization_name }}"
               required
               class="form-input"
               placeholder="e.g., Springfield Volunteer Fire Department"
               aria-required="true"
               aria-describedby="org-name-help">
        <p id="org-name-help" class="mt-1 text-sm text-gray-500">
            This will be displayed throughout the application.
        </p>
    </div>

    <!-- Color Theme Section -->
    <div class="border-t border-gray-200 pt-6">
        <h2 class="text-xl font-semibold mb-4 text-gray-900">Department Colors</h2>
        <p class="text-sm text-gray-600 mb-4">
            Choose colors that represent your department. We'll ensure they meet accessibility standards (Section 508 / WCAG 2.1).
        </p>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- Primary Color -->
            <div>
                <label for="primary_color" class="block text-sm font-semibold text-gray-700 mb-2">
                    Primary Color <span class="text-red-500" aria-label="required">*</span>
                </label>
                <div class="flex items-center space-x-4">
                    <input type="color"
                           id="primary_color"
                           name="primary_color"
                           value="{{ config.primary_color|default:'#DC2626' }}"
                           class="h-12 w-20 rounded border-2 border-gray-300 cursor-pointer"
                           aria-label="Select primary color">
                    <input type="text"
                           id="primary_color_text"
                           value="{{ config.primary_color|default:'#DC2626' }}"
                           pattern="^#[0-9A-Fa-f]{6}$"
                           class="form-input flex-1"
                           placeholder="#DC2626"
                           aria-label="Primary color hex code">
                </div>
                <p class="mt-1 text-sm text-gray-500">
                    Used for headers, buttons, and primary actions
                </p>
            </div>

            <!-- Secondary Color -->
            <div>
                <label for="secondary_color" class="block text-sm font-semibold text-gray-700 mb-2">
                    Secondary Color <span class="text-red-500" aria-label="required">*</span>
                </label>
                <div class="flex items-center space-x-4">
                    <input type="color"
                           id="secondary_color"
                           name="secondary_color"
                           value="{{ config.secondary_color|default:'#1F2937' }}"
                           class="h-12 w-20 rounded border-2 border-gray-300 cursor-pointer"
                           aria-label="Select secondary color">
                    <input type="text"
                           id="secondary_color_text"
                           value="{{ config.secondary_color|default:'#1F2937' }}"
                           pattern="^#[0-9A-Fa-f]{6}$"
                           class="form-input flex-1"
                           placeholder="#1F2937"
                           aria-label="Secondary color hex code">
                </div>
                <p class="mt-1 text-sm text-gray-500">
                    Used for secondary elements and backgrounds
                </p>
            </div>
        </div>

        <!-- Color Preview -->
        <div class="mt-6 p-4 bg-gray-50 rounded-lg border border-gray-200">
            <h3 class="text-sm font-semibold mb-3 text-gray-700">Preview:</h3>
            <div class="flex space-x-4">
                <button type="button" id="preview_primary" class="btn-primary" disabled aria-label="Primary button preview">
                    Primary Button
                </button>
                <button type="button" id="preview_secondary" class="btn-secondary" disabled aria-label="Secondary button preview">
                    Secondary Button
                </button>
            </div>
        </div>
    </div>
</div>

<script>
    // Sync color picker with text input
    const primaryColor = document.getElementById('primary_color');
    const primaryColorText = document.getElementById('primary_color_text');
    const secondaryColor = document.getElementById('secondary_color');
    const secondaryColorText = document.getElementById('secondary_color_text');
    const previewPrimary = document.getElementById('preview_primary');
    const previewSecondary = document.getElementById('preview_secondary');

    function updatePrimaryColor(color) {
        primaryColor.value = color;
        primaryColorText.value = color;
        previewPrimary.style.backgroundColor = color;
        document.documentElement.style.setProperty('--color-primary', color);
    }

    function updateSecondaryColor(color) {
        secondaryColor.value = color;
        secondaryColorText.value = color;
        previewSecondary.style.backgroundColor = color;
        document.documentElement.style.setProperty('--color-secondary', color);
    }

    primaryColor.addEventListener('input', (e) => updatePrimaryColor(e.target.value));
    primaryColorText.addEventListener('input', (e) => {
        if (/^#[0-9A-Fa-f]{6}$/.test(e.target.value)) {
            updatePrimaryColor(e.target.value);
        }
    });

    secondaryColor.addEventListener('input', (e) => updateSecondaryColor(e.target.value));
    secondaryColorText.addEventListener('input', (e) => {
        if (/^#[0-9A-Fa-f]{6}$/.test(e.target.value)) {
            updateSecondaryColor(e.target.value);
        }
    });

    // Initialize preview
    updatePrimaryColor(primaryColor.value);
    updateSecondaryColor(secondaryColor.value);
</script>
{% endblock %}
